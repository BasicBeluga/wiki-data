This article gets you started on compiling OpenTTD using Microsoft Visual C++ 2008 Express Editions (or MSVC++ Pro), Note that for the Express Editions addition compiling for 64-bit systems is unavailable. Also for additional help with compiling on various platforms, join [irc://irc.oftc.net/openttd.compile #openttd.compile] on OFTC.


__TOC__
=Required software=
:* [http://www.microsoft.com/express/download/default.aspx Microsoft® Visual C++ 2008 Express Editions] ''(current: Final)''
:* [http://www.microsoft.com/downloads/details.aspx?FamilyID=529f03be-1339-48c4-bd5a-8506e5acf571 Microsoft® DirectX SDK - August 2007 or earlier] ''(only needed for DirectX Music, otherwise can be skipped. More later on.)''

:* [http://www.openttd.org/download-openttd-useful openttd-useful.zip] ''(current: 3.0)''
:** openttd_useful.zip is a collection of files of varying age. For the latest zlib, libpng and FreeType files you can browse their websites below.
:** [http://www.zlib.net/ zlib]
:** [http://sourceforge.net/project/showfiles.php?group_id=23617&package_id=16183 GnuWin32 libpng]
:** [http://gnuwin32.sourceforge.net/downlinks/freetype.php GnuWin32 FreeType]
:** [http://icu-project.org/download/ ICU4C]
:** [http://www.freshports.org/archivers/lzo2/ MiniLZO]
:...and of course the newest source from <code>svn://svn.openttd.org/trunk</code>. You need to have a SVN-client to download the source from the SVN server. Pick either of the following two. For SVN novices TortoiseSVN is highly recommended:

:* [http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100&expandFolder=8100&folderID=91 Subversion command line version] binares ''(current: 1.6.6)''
:* [http://tortoisesvn.net/downloads GUI TortoiseSVN] ''(current: 1.6.6)''

:'''Note:''' This guide has been made on Windows Vista 32bit (also compatible with x64 and Windows 7).

=Required Documents=
:*http://wiki.openttd.org/Microsoft_Visual_C%2B%2B_2005_Express_Editions
'' It is useful to read those Instructions, as they include some basic pre-requisites ( and it has pictures too )''

=Installing=
[[File:en/Archive/Compilation and Ports/Microsoft Visual Cpp 2008 Express Editions.png|thumb|200px|Install screen]]

===Microsoft® Visual C++ 2008 Express Editions===
:If you just need to compile OpenTTD it's enough if you don't select any options, keep the default options and wait for the installation to finish (for illustration click the image).



===Microsoft® DirectX SDK===
If you don't want/need music, you can skip DirectX SDK. Please read next chapter on that.
:'''Install the version August 2007 or earlier'''
:From the components screen remove the documentation and sample source code you'll save a lot of space. They're pretty useless if you just need to compile OpenTTD (see the image below). 
{{en/Note|You should not use a version newer then August 2007 as DirectMusic is no longer support as of the November 2007 release.}}

:As August 2007 or earlier installer doesn't support Microsoft® Visual Studio 2008, you will have to set up the VC++ directories manually.

:Go to <code>Tools -> Options</code>, then to <code>Projects and Solutions -> VC++ Directories</code>. Add the following lines:

:Include files:
:* C:\Program Files\Microsoft DirectX SDK\Include

:Library files:
:* C:\Program Files\Microsoft DirectX SDK\Lib\x86

:'''Note:''' Please update the paths as necessary.

===Without Microsoft® DirectX SDK===
[[File:en/Archive/Compilation and Ports/Preprocessor.png|thumb|left|200px|Preprocessor settings]]
[[File:en/Archive/Compilation and Ports/Linker.png|thumb|left|200px|Linker settings]]

: '''Alternative''': If you are willing to compile without support for MIDI music you will not be needing the DirectX SDK. To disable music, open the "openttd" project properties dialog and:
:* Navigate to <code>Configuration properties -> C/C++ -> Preprocessor -> Preprocessor Definitions</code> and remove <code>WIN32_ENABLE_DIRECTMUSIC_SUPPORT</code> preprocessor definition.
:* Navigate to <code>Configuration properties -> Linker -> Input -> Additional Dependencies</code> and remove <code>dxguid.lib</code> library.

=Copying from OpenTTD needed includes and libraries=
===openttd_useful.zip===
:*Extract the [http://binaries.openttd.org/extra/openttd-useful/ Openttd-useful.zip] file and copy the content to some <code><personal folder></code>.
:*Now you need to tell Visual C++ where the files are located. Navigate to ''Tools > Options > Projects and Solutions > VC++ Directories'':<br />
:**Select Platform '''Win32''' (Be sure that all your entries are '''before''' any SDK folder!):
:***Select '''Include Files''', press the new folder button and add the folder <code><personal folder>\shared\include</code> to the list.
:***Select '''Library Files''', press the new folder button and add the folder <code><personal folder>\win32\library</code> to the list.
:**Select Platform '''x64''' (Skip if it isn't available! Again be sure that all your entries are '''before''' any SDK folder!) :
:***Select '''Include Files''', press the new folder button and add the folder <code><personal folder>\shared\include</code> to the list.
:***Select '''Library Files''', press the new folder button and add the folder <code><personal folder>\win64\library</code> to the list.<br />

:Don't forget to replace <code><personal folder></code> with the folder where you extracted openttd-useful.zip.

=Subversion=
===Getting the client===
[[File:en/Archive/Compilation and Ports/SVN Checkout.png|thumb|400px|The SVN Checkout Box]]
Subversion is needed to download the source (the place where do find the MSVC project file. If you want an easy, GUI subversion client, download and install [http://tortoisesvn.net/downloads TortoiseSVN].

===Make the directory===

Make a directory called "ottdsrc" in your C:\ drive. It is important to make a directory without spaces since [[en/Archive/Compilation and Ports/Compiling on Windows using MinGW]] (the program used later for [[#bundle|making a bundle]]) can only switch to directories without spaces. This will be used as a place to download the source to.

===Download the source===

To download the actual source of OpenTTD, right click inside the folder <code>C:\ottdsrc</code>, then go to '''SVN Checkout'''.

In '''SVN Checkout''', make sure you have the url of the OpenTTD trunk source (svn://svn.openttd.org/trunk) in the "URL of Repository" box.

To get the latest revision, get the HEAD Revision. To get an older/different revision, highlight the "Revision" box and type in the revision number you want specifically. For now, you can just download the HEAD revision, unless you need another revision. This takes about 5-20 minutes depending on your internet.

=Compiling=
'''Debug''' (Debugging crashes only):
:* Open <code>projects/openttd_vs90.sln</code>. This will open your IDE with the project loaded.
:* Go to <code>Build -> Configuration Manager</code> and check if it is set to <code>Debug</code>. By default, it should be.
:* Right-click on openttd (project) -> Properties -> C/C++ -> -> General -> Additional Include Directories. Add the DirectX headers subdirectory (Usually, <code>C:\Program Files\Microsoft DirectX SDK (August 2007)\Include</code>)
:* Press <code>F7</code>, or go to <code>Build -> Build Solution</code>.
'''Release''' (Recommended):
:* Open <code>projects/openttd_vs90.sln</code>. This will open your IDE with the project loaded.
:* Go to <code>Build -> Configuration Manager</code> and select <code>Release for OpenTTD</code>.
:* Right-click on openttd (project) -> Properties -> C/C++ -> -> General -> Additional Include Directories. Add the DirectX headers subdirectory (Usually, <code>C:\Program Files\Microsoft DirectX SDK (August 2007)\Include</code>)
:* For '''Win32''':
:** Right-click on openttd (project) -> Properties -> Linker -> General -> Additional Library Directories. Add the DirectX SDK Lib subdirectory (Usually, <code>C:\Program Files\Microsoft DirectX SDK (August 2007)\Lib\x86</code>)
:* For '''Win64''':
:** Right-click on openttd (project) -> Properties -> Linker -> General -> Additional Library Directories. Add the DirectX SDK Lib subdirectory (Usually, <code>C:\Program Files\Microsoft DirectX SDK (August 2007)\Lib\x64</code>)
:* Make sure to press ''Apply'' then press ''Ok'', this is important.
:* Press <code>F7</code>, or go to <code>Build -> Build Solution</code>.

=Bundle=

This is not necessary in compiling OpenTTD, only if you want to upload your binary publicly. The purpose of this article is to get the equivalent of a "<code>make bundle</code>" for MSVC builds. {{en/Note|You must have MSYS installed for this to work. To get it, follow [[en/Archive/Compilation and Ports/Compiling on Windows using MinGW#setting-up-mingw|this guide]]. You only need to use the part which says "Setting Up MinGW", "Setting up MSYS" and "Install SVN", then you are good to go. Note that when installing MinGW, you do ''not'' need to install the g++ compiler, but you still need to install the candidate.}}
You will first need to change the directory to your OpenTTD source. Use this command to change directory: <code>cd <directory></code>. To change to your new source directory, type <code>cd /c/ottdsrc</code>

Then, enter the command:
<pre>make -f Makefile.msvc bundle PLATFORM=WIN32</pre>
Replace <code>PLATFORM=WIN32</code> with <code>PLATFORM=x64</code> if you compiled a 64-bit build.

After this is done, you can find the contents in the <code>/bundle</code> directory. From there, you can make a zip/rar out of the files. Remember, TT-Forums.net[http://tt-forums.net] only allows files that are less than or equal to 4 MiB.

=Running/Debugging the game=

Make sure you have either the [[en/Manual/Installation#files-from-ttd|original game files]] or our free alternatives [[en/Archive/Community/Sound Effects Replacement]] and [[en/Archive/Community/OpenGFX Readme]] placed in My Documents/OpenTTD/data/ , that way they're shared by all your OpenTTD installations and you don't have to copy them to every new installation.

=Credits=

:* OpenTTD Developers for the great game.
:* Microsoft® for the the SDKs and Visual C++ 2008 Express Edition.
:* Sebastian and Desolator (aka Mircea Chirea) for creating/updating the Microsoft® Visual C++ 2005 Express guide.

[[Category:en/Development]]
[[Category:en/Development/Compiling OpenTTD]]
[[Category:en/Development/Microsoft Visual C++]]
[[Category:en/Archive/Program Descriptions]]