[[Category:en/Manual/Installation]]

It is possible to get OpenTTD to play music using the wavetable feature of a SB Live card (aka Awe32/64 or Emu10k1).  This method does not use timidity and therefore does not hammer the CPU.

These instructions are written for Ubuntu Feisty (7.04), so adjust as necessary for your distribution.

First install the awesfx package. This supplies the <tt>asfxload</tt> utility which is used to load soundfonts onto the soundcard.

Then find the files <tt>8mbgmsfx.sf2</tt>, <tt>4gmgsmt.sf2</tt> and <tt>2gmgsmt.sf2</tt> from the SB Live installation CD (or somewhere on your windows partition) and put them into <tt>/usr/share/sounds/sf2</tt>.

Then run
<pre>asfxload 8mbgmsfx</pre>
to load the soundfont onto the sound card.

Next run 
<pre>aplaymidi -l</pre>
You should see output similar to this:
<pre>
 Port    Client name                      Port name
 14:0    Midi Through                     Midi Through Port-0
 16:0    SBLive 5.1 [SB0060]              EMU10K1 MPU-401 (UART)
 17:0    Emu10k1 WaveTable                Emu10k1 Port 0
 17:1    Emu10k1 WaveTable                Emu10k1 Port 1
 17:2    Emu10k1 WaveTable                Emu10k1 Port 2
 17:3    Emu10k1 WaveTable                Emu10k1 Port 3
</pre>

Note the port for Emu10k1 Port 0 (17:0 in this example)

run the following substituting the port above.
<pre>export ALSA_OUTPUT_PORTS="17:0"</pre>

you should now be able to use aplaymidi to play one of the gm files from the gm directory.

Assuming That worked correctly, the last step is to edit <tt>~/.openttd/openttd.cfg</tt>

In the [music] section set the extmidi line to:
<pre>extmidi = /usr/bin/aplaymidi</pre>

You should now have midi sound working in OpenTTD without it eating up all your CPU time.

To automate setting the port, create a shell script somewhere (e.g. <tt>/usr/games/openttd.sh</tt>) with the following:
<pre>
#!/bin/bash

APLAYMIDI='/usr/bin/aplaymidi'

if [ ! -x $APLAYMIDI ]; then
        echo "Error: Cannot execute $APLAYMIDI"
        exit 1
fi

export ALSA_OUTPUT_PORTS=`$APLAYMIDI -l | grep "Emu10k1 Port 0" | awk '{print $1}'`

exec /usr/games/openttd
</pre>
Now use this to launch OpenTTD.