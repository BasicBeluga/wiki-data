[[Translation:en/Archive/Manual/Yet Another PBS Patch]]
Yet Another PBS Patch (or just YAPP) is a PBS patch developed by [[en/Michi cc]]. YAPP implements a realistic signalling system, similar to [[en/Archive/Manual/Yet Another PBS Patch|the one]] described by [[en/Tekky]] (although the YAPP implementation does not feature real bi-directional tracks). Currently, YAPP isn't available in any official version of OpenTTD and can only be aquired by compiling the game yourself or downloading one of the many ''patch packs'' available at [http://www.tt-forums.net/viewforum.php?f=33 tt-forums.net].

{{en/Note|This article describes a feature which is not available in any official version of OpenTTD.}}

==Features==
* Works with NPF and YAPF.
* Implements a signal system similar to the one Tekky described (without real bi-di tracks).
* Is fully backwards compatible, normal and PBS signals can be used in parallel.
* Can colour the reserved paths.

=Tutorial=

==The basics==
This paragraph covers the basic features of YAPP, and should get you going on using it.

===The Signals===
[[File:en/Manual/Yapp signalgui.png|frame|right|Two new signal types in the signal GUI.]]YAPP adds two new signal types to the game. These signals enable trains to reserve a path through a signal block before entering the block. If another train wants to enter the block, and succeeds in reserving a path through the block, both trains can use one signal block at the same time.


As mentioned before, there are two signal types, available in the [[en/Manual/Signal GUI]]. The first type is the basic YAPP-PBS signal. There are two things you should know about this signal:
* Place it only where trains can stop and wait safely without blocking junctions and other things.
* Trains can pass through this signal from the back side.
[[File:en/Manual/Yapp pbssignal.png|frame|right||PBS Signal]]This signal will be called a ''PBS Signal''.


There are also two things you should know about the second signal type:
* Place it only where trains can stop and wait safely without blocking junctions and other things.
* Trains can pass through this signal from one direction.
[[File:en/Manual/Yapp onewaypbssignal.png|frame|right|One-Way PBS Signal]]This signal will be called a ''One-Way PBS Signal''.


Most of the times it will be sufficient to use a default PBS signal, as passing a signal from the back is penalised by the pathfinder, however, one-way PBS signals might be useful in certain specific cases.


The two new signal types behave a bit different than standard OpenTTD signal types. The PBS signals are red by default, and will only show green as soon as a train can reserve a path to a safe waiting position. Safe waiting positions are in front of other signals, depots and track ends. The back of a PBS signal is not a safe waiting position, and therefore paths are reserved through these signals.

Because in front of every signal, there is a safe waiting position, in most cases you cannot place a signal right behind a junction. That way, a train would stil be able to block a junction (see example below).
[[File:en/Manual/Yapp unsafewaitinglocation.png|frame|center|The signal indicated by the arrow is an unsafe waiting location, as the train in the junction now blocks the otherwise free path of the train coming from the top. There's a second unsafe waiting location in this picture. Can you find it?]]

===Patch Options===
[[File:en/Manual/Yapp patch-options.png|frame|right|YAPP Patch options]]YAPP adds two patch options to the game.


One option is to highlight reserved PBS tracks. This option is useful to troubleshoot your PBS junctions, as you can see what paths trains have reserved through a PBS block.


The other option is how ctrl+click on a signal should behave. This option enables you to set what signal types should be cycled through.


There are a few more patch options which are not available through the Configure Patches windows. What these options are, and how to edit them is covered in [[#advanced-patch-options]].

==Basic Examples==
Below are some example track layouts which use the YAPP-PBS signals.

===Basic junction===
This basic junction now has a much higher throughput.
[[File:en/Manual/Yapp basicjunction.png|frame|center|Basic junction for trains with maxlength three tiles. Note the use of normal signals on plain track.]]

===Basic two-way station===
With this station layout, trains can use both platforms when coming from either direction.
[[File:en/Manual/Yapp basicstation.png|frame|center|Basic station.]]

===Basic two-way double track layout===
Extremely useful when you have breakdowns enabled. If a train breaks down, other trains are able to pass it using the opposite track.
[[File:en/Community/Junctionary/Yapp dualtrack.png|frame|center|Double two-way track. All signals are safe waiting locations.]]

==Advanced patch options==
These patch options are located in your [[en/Archive/Manual/Settings/Openttd.cfg]] file. This file is located in either you home directory (My documents on Windows) or your OpenTTD installation directory. Open this file using your favourite plain text editor. The following options are added by YAPP. Just adapt the values to your needs.
* wait_for_pbs_path (set this value to 255 if you don't want trains to ''ever'' turn around at a pbs signal)
* reserve_paths
* path_backoff_interval
* npf_rail_pbs_cross_penalty
* npf_rail_pbs_signal_back_penalty
* rail_pbs_cross_penalty
* rail_pbs_station_penalty
* rail_pbs_signal_back_penalty

==Advanced examples==
Below are some example advanced track layouts which use the YAPP-PBS signals.

===Advanced junction with crossover===
The crossover increases the chance that a train finds a path, even if the junction is occupied by a train from the opposite direction.
[[File:en/Community/Junctionary/Yapp advancedjunction.png|frame|center|Just try this one yourself!]]

===Advanced two-way station===
At heavily used two-way stations sometimes deadlock can occur. The use of one-way PBS signals dedicates a platform to one specific direction, which decreases the chance of a deadlock. (Most of the times a deadlock occurs when all platforms are occupied by trains wanting to travel in the same direction, but the way out is clogged)
[[File:en/Community/Junctionary/Yapp advancedstation.png|frame|center|Notice the use of one-way signals.]]

===Advanced two-way quadruple track layout===
Still playing with breakdowns, aren't you? This layout solves all your problems.
[[File:en/Community/Junctionary/Yapp quadtrack.png|frame|center|Quad two-way track layout.]]