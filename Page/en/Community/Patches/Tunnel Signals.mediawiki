Tunnels with signals.

Not being able to use signals in long tunnels limited their use dramatically.
I normally located depots next to them as to absorb traffic jams.
I made a solution now that simulates signals in the tunnel.
The working is quite simple.
Every time after a train enters the tunnel, it becomes invisible for the train behind it.
When the train behind is faster it will be stopped when coming to close to the train in front.
This is the same as putting a signal on every tile along the track.
The distance between trains in the tunnel is approximately 2 tiles.

== Current patch ==

* [http://www.tt-forums.net/download/file.php?id=108105] (against r15832)

== Features ==

* Enter/leave road and rail depots from front and back sides
* Leaving depot triggers "leave station" codepaths, ie determine path to next order and reverse/don't reverse as necessary. If no path found or no next order, vehicle leaves as it entered, just like regular depots
* Two vehicles can enter/leave depot from opposite sides at the same time without collisions
* Building a depot will also build junction rails/roads on both sides as required

== Todo ==

* Be more deliberate about allowing pathfinder to find a path through the depot, with some explicit cost
* Make it so that there can only be one train on the depot tile at a time, with pseudo-signals to stop entering
** It currently looks really ugly when two trains are entering/leaving at the same time as they draw on top of each other
* Allow vehicles to drive through without stopping
** Enabled via an advanced option
** Incurs a speed penalty
* Expose drive-through depots to AIs

=== To be considered ===

* Are single-entry depots required anymore?
** If you only want to use one side, just don't hook up the other side.
** On the other hand, a front-side door to nowhere looks silly
** Also potential frustration with the autotrack/road stuff if you didn't want to join the depot to one side
* Are new graphics required?


== Discussion ==

http://www.tt-forums.net/viewtopic.php?f=33&t=41260&start=0