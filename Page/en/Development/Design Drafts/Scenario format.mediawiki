=Extended heightmap format=

The extended heightmap format aims to store most of the information of a scenario (terrain, water, towns, etc) in a NewGRF agnostic way. Since company property is not intended to be part of scenarios, this format will not be including it. Depending on the information included in the extended heightmap it will be possible to scale the extended heightmap to different sizes or it will be fixed.


NOTE: Unless mentioned otherwise, all properties are optional.


An extended heightmap is distributed as a tar file. The file includes the following parts:

* Metadata file: Stores datafile and layer data.

* Layers: Each layer stores information for each one of the points in the map.

* Object files: Each object file contains information about a given entity, such as towns.

* Language files: Language files contain the extended heightmap name and its description. There are multiple files, one for each supported language.

==Metadata file==

The metadata file must be called "metadata.txt".

===Extended heightmap section===

The first section includes information about the extended heightmap itself.

* Width: By default, the extended heightmap will be scaled to this width. The user can still choose which width to use. This information will be ignored if the heightmap is not scalable.

* Height: By default, the extended heightmap will be scaled to this height. The user can still choose which height to use. This information will be ignored if the heightmap is not scalable.

* Rotation: Indicates the preferred orientation for the extended heightmap. The possible values are "cw" (clockwise rotation) or "ccw" (counter clockwise rotation). OpenTTD will select this orientation automatically, but it will still allow the user to change the orientation.

* Climate: By default, the extended heightmap will use this climate. OpenTTD will select this climate automatically, but it will still allow the user to change the climate. This property can use the following values: "temperate", "arctic", "tropical" and "toyland".

* Snowline: Default snowline for the extended heightmap. This value will be ignored if the climate is not set to subarctic, or if the extended heightmap is loaded with a snowline NewGRF. OpenTTD will select this snowline automatically, but it will still allow the user to change the snowline. This property must be in the [0, 15] range.

===Layer sections===

All included layers must have their own section in this file. The [height_layer] section is compulsory, since all extended heightmaps must have a height layer. Other layers are optional. Each layer section can have a file property that indicates which file contains the layer date if not included, a default file name will be used. Some layers can also have extra properties. Note that even if a layer has no extra properties and uses the default file name, it must still have an empty section. Otherwise OpenTTD will ignore the layer.

===Object file sections===

Each object file has its own section. Their file property is also optional; if not included they will use the default file name. The section must be present even if it is empty, otherwise OpenTTD will ignore the object file.

===Example of metadata file===

<pre>[extended_heightmap]
width=128
height=256
orientation=ccw
climate=arctic
snowline=12

[height_layer]
file=heightmap.png
min_used_height=0
max_used_height=255
min_desired_height=0
max_desired_height=15

[water_layer]
file=rivers.png

[road_layer]
layer=roads.png

[town_file]
file=town_data.txt

[tunnelbridge_file]
file=extra_road_data.txt</pre>

==Layers==

Each layer stores information for each one of the points in the map in PNG format. Scalable layers are those that can be scaled to valid map sizes without a critical loss of information. Extended heightmap that include only scalable layers can have layers of any size, and they will be scaled when the game is generated.

If an extended heightmap contains one or more non scalable layers, all layers must have the same size, and it must be a valid OpenTTD map size. If these conditions are not fulfilled, OpenTTD will not be able to load the extended heightmap. Since they contain position information, object files are treated as non scalable layers in this regard. The different types of layers are described below.

===Height layer===

Metadata section: [height_layer]

Default filename: height.png

Scalable: Yes

Height layers are 8 bit grayscale images that describe the height of each point of the map as a number in the [0, 255] interval. OpenTTD will scale the height information depending on the optional fields of the height layer metadata section.

* min_desired_height: Indicates the minimum height of the resulting OpenTTD map. If set above 0, the resulting map will have no sea at all. This property must be in the [0, 15] range. This property has a default value of 0.

* max_desired_height: Maximum height of the resulting OpenTTD map. This property must be in the [0, 15] range. This property has a default value of 15.

* min_used_height: Indicates the minimum height from tle layer to take into account in the scaling. This height and all heights below this one will be converted to min_desired_height. This property must be in the [0, 255] range. This property has a default value of 0.

* max_used_height: Maximum height that OpenTTD will use to do the scaling. This height and all heights above this one will be converted to max_desired_height. This property must be in the [0, 255] range. This property has a default value of 255.

===Terrain layer===

Metadata section: [terrain_layer]

Default filename: terrain.png

Scalable: Yes

The terrain layer is a paletted PNG image that stores information about the terrain type of each one of the tiles.

* Default: Default terrain.

* Rough: Rough terrain.

* Rock: Rocky terrain.

===Water layer===

Metadata section: [water_layer]

Default filename: water.png

Scalable: Yes

Water layers are paletted PNG images which indicate the presence or abscense of water in each tile. If a water layer is not present, OpenTTD will assume that all tiles with a resulting height of zero are sea. If the water layer is present, OpenTTD will only mark as sea those tiles indicated in the water layer (Issue: OpenTTD will flood any tiles with a height of zero in the border of the map).

Water layers include the following information:

* No water: This is not a water tile

* Sea: Only tiles at zero height can be marked as sea. OpenTTD will treat any tiles marked as sea above height zero as rivers.

* River: Used to mark tiles as river.

===Tropical layer===

Metadata section: [tropical_layer]

Default filename: tropical.png

Scalable: Yes

The tropical layer is a paletted PNG image that stores information about the subtropical type of each one of the tiles.

* Default: Default terrain.

* Half desert: Half desert terrain

* Desert: Desert terrain.

* Rainforest: Rainforest terrain.

===Road layer===

Metadata section: [road_layer]

Default filename: road.png

Scalable: No

Road layers are two-colour paletted PNG images that indicate the roads present in the map. Issue: what should we do with roads that are part of a town?

===Canal layer===

Metadata section: [canal_layer]

Default filename: canal.png

Scalable: No

Canal layers are two-colour paletted PNG images that indicate the canals present in the map.

===Industry layer===

An industry layer is planned, but since it is quite complicated it won't be designed until everything else is already implemented and working.

==Object files==

Object files contain text data associated to a given game entity. With regard to extended heightmap scalability, all object files are treated as non scalable layers.

The "direction" fields can take the following values:

* NE: Northeast
* NW: Northwest
* SE: Southeast
* SW: Southwest

===Town file===

Metadata section: [town_file]

Default filename: town.txt

The town file lists all towns included in the extended heightmap along with their position and properties. If this object file is not present, towns will be randomly generated accordingly to the current OpenTTD settings. There is a [town] section for each town, and it includes the following properties:

<pre>[town]
name=Town Name 1
posx=59
posy=12
buildings=32
city=false
layout=random</pre>

* posx: X position of the town. This property is obligatory.

* posy: Y position of the town. This property is obligatory.

* name: Town name. If missing, a random town name (with the selected town name generator) will be used.

* buildings: Number of buildings that this town will have. If missing, the default size for current OpenTTD settings will be used.

* city: True iff the town will grow faster than other towns. The default value is "false".

* layout: Road layout to use in this town. It can be "original", "better" (better roads), "2x2", "3x3" and "random". If this property is missing, the current layout chosen in OpenTTD options will be used.

===Tunnel and bridge file===

Metadata section: [tunnelbridge_file]

Default filename: tunnelbridge.txt

This file stores all road tunnels and bridges. All properties are obligatory.

<pre>[tunnel]
posx=34
posy=59

[bridge]
posx=12
posy=95
direction=SW
length=12</pre>

===Aqueduct===

Metadata section: [aqueduct_file]

Default filename: aqueduct.txt

This file stores all aqueducts. All properties are obligatory.

<pre>[aqueduct]
posx=12
posy=950
direction=NE</pre>