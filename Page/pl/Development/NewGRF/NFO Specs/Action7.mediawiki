{{pl/Development/NewGRF/inne strony|en=newgrf-specs.tt-wiki.net/wiki/Action7|pl=pl/Development/NewGRF/NFO Specs/Action7}}
<!--[[Category:Artykuły w języku polskim/Pl]]-->
<!--{{-}}<br>{{ambox | text = w trakcie edycji.}}-->

== Wprowadzenie ==

Działanie 7 i Działanie 9

Warunkowo pomiń 'sprites' lub przejdź do etykiety

== Description ==

Te dwie akcje pozwalają pominąć określoną liczbę lub wszystkie następujące duszki w tym pliku .grf. Można to wykorzystać np. Do grafiki specyficznej dla klimatu, kontroli wersji poprawek i komunikatów o błędach oraz dezaktywacji w obecności innych aktywnych plików .grf.

== Syntax ==

Dane wyglądają następująco:

 <sprite-number> * <length> [07/09] <variable> <varsize> <condition-type> <value> <num-sprites> 
{|
!Element!![[en/GRFActionsDetailed|Size]]!!Description
|-
|<sprite-number>||dec||A sequential sprite number
|-
|<length>||dec||The total number of bytes in the action
|-
|07/09||B||Action type.  In this case, 07 or 09
|-
|<variable>||B||Which variable to base the decision on
|-
|<varsize>||B||How many bytes to read from the variable
|-
|<condition-type>||B||What condition to check
|-
|<value>||V||Value to compare with (size equals <varsize>)
|-
|<num-sprites>||B||How many sprites to skip
|}

== Filling in the terms ==

=== sprite-number ===

The current sprite number.

=== length ===

The total number of bytes in this action 7 or 9.

=== action ===

Rodzaj akcji definiowany przez te pseudo-'sprites'. Jest to 07 lub 09, w zależności od tego, czy używasz akcji 7, czy akcji 9.

Oba mają identyczny format, jedyną różnicą jest to, czy duszki będą pomijane podczas inicjalizacji systemu graficznego TTDPatch, czy tylko wtedy, gdy plik .grf stanie się aktywny.

Działanie 9 jest zawsze wykonywane, zarówno podczas inicjalizacji, jak i aktywacji, ale działanie 7 jest wykonywane tylko podczas aktywacji.

W zależności od akcji, które chcesz pominąć, nie zawsze możesz użyć obu akcji. W razie wątpliwości użyj akcji 7, z wyjątkiem pominięcia akcji 6 lub F. Nie możesz w ogóle pomijać akcji 2, chyba że pominiesz całą resztę pliku. Zamiast tego pomiń działanie 3, które go dotyczy.

Oto tabela pokazująca cały problem z akcji 7/9:
{|
!Action to skip!!with 7!!with 9!!notes
|-
|0 (new props)||yes||yes||To skip new properties unknown to old OpenTTD or TTDPatch you have to use Action 9.
|-
|1 (sprite blk)||yes||yes||
|-
|2 (cargo ID)||n/a*||no||* skip the corresponding action 3 instead
|-
|3 (veh ID map)||yes*||no||* can't skip a livery override without skipping the main engine action 3 as well
|-
|4 (veh names)||yes||no||
|-
|5 (sprite blk)||yes||yes||
|-
|6 (apply param)||n/a*||yes||* "yes" since TTDPatch 2.0.1 alpha 51
|-
|7 (skip sprite)||yes||yes||
|-
|8 (GRFID)||yes||yes||
|-
|9 (skip sprite)||yes*||yes||* not during initialization, of course
|-
|A (repl.sprite)||yes||yes||
|-
|B (error msg)||yes||yes||
|-
|C (NOP)||yes||yes||
|-
|D (set param)||yes*||yes||* not if parameter will be used in action 6 (except for TTDPatch 2.0.1 alpha 51 and higher)
|-
|E (deact.GRFs)||yes||yes||
|-
|F (town names)||n/a||yes||
|-
|10 (goto labels)||n/a||no||
|-
|11 (sound fx)||n/a||no||
|-
|12 (glyphs)||yes||yes||
|-
|13 (translate)||yes||yes||
|-
|14 (static info)||n/a||n/a|| 
|}

Yes=safe to skip

No=not safe to skip, will break the grf file or TTDPatch

N/A=not applicable; it won't break anything, but it won't actually be skipped either (in other words, its definitions will continue to be used)

=== variable ===

To ustawia zmienną, na której opiera się decyzja. Może to być jeden z parametrów GRF (patrz  [[en/Action6|action 6]] ) lub wbudowana zmienna łatki. Jeśli jest to parametr GRF, który nie został określony w pliku newgrf (w) .cfg, lub zmienna 88 z GRFID, który nie istnieje, akcja 7 lub 9 jest ignorowana i nie są pomijane żadne duszki, jedynym wyjątkiem jest warunek wpisz 0A, który pominie  'sprites' , jeśli GRFID również nie istnieje.

{| |-
!Variables!!Description
|-
|00-7F||GRF parameters, see [[en/Action6]].
|-
|80-BF||See [[en/GlobalVariables| global variables page]].
|-
|C0-FF||Reserved. Do not use.
|}

=== varsize ===

W przypadku parametrów GRF jest to to samo, co <param-size> w [[en/Action6#param-size|action 6]] . W przypadku zmiennych wbudowanych zależy to od zmiennej, patrz powyższa tabela.

W przypadku testów bitowych ten rozmiar jest ignorowany. Wartość musi być BYTE dla testów bitowych, niezależnie od wielkości testowanej zmiennej.

Od r1384 możliwe jest ustawienie tej wartości na 8 bajtów ze zmienną 88, umożliwiając w ten sposób użycie maski bitowej. Jest to przydatne, gdy tylko kilka bitów zmienia się w kilku plikach graficznych.

=== condition-type ===

Istnieje kilka warunków, z których możesz wybrać test. Ma sekwencję zmiany znaczenia dla każdej prawidłowej wartości. Zobacz [[en/GRFActionsDetailed#byte-order|the discussion of escape sequences]] w celu uzyskania dalszych informacji na temat sekwencji specjalnych. Dla Twojej wygody są one podsumowane w jeszcze jednym stole:
{|
!Condition type!!Escape!!Version!!Description
|-
|00||\71||{{Page:pl/Extrazi/ottdp|0.6| }}||Test for bit given by value being set
|-
|01||\70||{{Page:pl/Extrazi/ottdp|0.6| }}||Test for bit given by value being clear
|-
|02||\7=||{{Page:pl/Extrazi/ottdp|0.6| }}||Parameter is equal to value
|-
|03||\7!||{{Page:pl/Extrazi/ottdp|0.6| }}||Parameter is not equal to value
|-
|04||\7<||{{Page:pl/Extrazi/ottdp|0.6| }}||Parameter is less than value
|-
|05||\7>||{{Page:pl/Extrazi/ottdp|0.6| }}||Parameter is greater than value
|-
|06||\7G||{{Page:pl/Extrazi/ottdp|0.6| }}||GRFID (see [[en/Action8|action 8]]) is active (for variable 88 only)
|-
|07||\7g||{{Page:pl/Extrazi/ottdp|0.6| }}||GRFID is not active (for variable 88 only)
|-
|08||\7gG||{{Page:pl/Extrazi/ottdp|0.6| }}||GRFID is not active yet but will be activated (variable 88 only)
|-
|09||\7GG||{{Page:pl/Extrazi/ottdp|0.6| }}||GRFID is or will be active (variable 88 only)
|-
|0A||\7gg||{{Page:pl/Extrazi/ottdp|0.6| |ottdrev=r11358}}||GRFID is not nor will it be active (variable 88 only)
|-
|0B||\7c||{{Page:pl/Extrazi/ottdp|0.6| |ottdrev=r11358}}||Cargo type is not available (variable is ignored; value is the label)
|-
|0C||\7C||{{Page:pl/Extrazi/ottdp|0.6| |ottdrev=r11358}}||Cargo type is available (variable is ignored; value is the label)
|-
|0D|| ||{{Page:pl/Extrazi/ottdp|0.7|no|ottdrev=r15418}}||Railtype label is not defined (variable is ignored; value is the label)
|-
|0E|| ||{{Page:pl/Extrazi/ottdp|0.7|no|ottdrev=r15418}}||Railtype label is defined (variable is ignored; value is the label)
|-
|0F|| ||{{Page:pl/Extrazi/ottdp|1.10|no|}}||Roadtype label is not defined (variable is ignored; value is the label)
|-
|10|| ||{{Page:pl/Extrazi/ottdp|1.10|no|}}||Roadtype label is defined (variable is ignored; value is the label)
|-
|11|| ||{{Page:pl/Extrazi/ottdp|1.10|no|}}||Tramtype label is not defined (variable is ignored; value is the label)
|-
|12|| ||{{Page:pl/Extrazi/ottdp|1.10|no|}}||Tramtype label is defined (variable is ignored; value is the label)
|}

Zauważ, że dla znaków wielka litera oznacza dostępne, a mała litera oznacza niedostępne. W przypadku dwuznakowych sekwencji GRFID, pierwszy znak to jego obecny stan, a drugi to jego przyszły stan.

Testy dla zmiennej 88 zależą od bieżącego [[en/GrfLoadingStages|GRF Loading Stage]] , kolejności, w jakiej GRF są ładowane, i oczywiście, czy są one obecne, czy zostały wyłączone (przez siebie lub przez inne GRF). Rozważ dwa GRF A i B (załadowane w tej kolejności):

{| |-
!rowspan="2"| Condition
!colspan="2"| Initialisation
!colspan="2"| Reservation/Activation
!rowspan="2"| Tested GRF not present
|-
! A testing for B !! B testing for A !! A testing for B !! B testing for A
|-
|-
|06  \7G   || always false          || always false          || always false          || A not disabled?       || always false
|-
|07  \7g   || always true           || always true           || always true           || A disabled?           || always false
|-
|08  \7gG  || always false          || A not (yet) disabled? || B not (yet) disabled? || always false          || always false
|-
|09  \7GG  || always false          || A not (yet) disabled? || B not (yet) disabled? || A not disabled?       || always false
|-
|0A  \7gg  || B (already) disabled? || A (already) disabled? || B (already) disabled? || A disabled?           || always true
|}

If the tested GRF is not present, conditions 06 to 09 always evaluate to "false". For condition 0A "disabled" and "not present" are the same, i.e. it always evaluates to "true".

=== value ===

Ten termin jest porównywany ze zmienną. Jego rozmiar podaje <varsize>.

W przypadku testów bitowych (typy warunków 00 lub 01) zawsze musi to być pojedynczy BYTE dla testów bitowych i określa bit do przetestowania.

Dla warunków 0B, 0C, 0D i 0E wartość określa bezpośrednio etykietę typu ładunek / szyna; to nie jest indeks do tabeli translacji.

Dla warunków 0B i {{Page:pl/Extrazi/ottdp| |2.5|ttdprev=alpha 72}} 0C, podana zmienna jest ignorowana (ale mimo to musi być poprawną zmienną), zmienna musi mieć wartość 4, a wartość musi być etykietą ładunkową do sprawdzenia. Jeśli żaden ładunek z tą etykietą nie jest zdefiniowany w przypadku warunku 0B, podana liczba duszków jest pomijana. Dla warunku 0C duszki są pomijane, jeśli etykieta ładunku została zdefiniowana. Oba testy działają niezależnie od kolejności plików .grf w newgrf (w) .cfg; ładunek jest uważany za dostępny, nawet jeśli jest zdefiniowany w późniejszym pliku grf. Aby działało to poprawnie, nie wolno  (''must not'') pomijać definicji ładunku z warunkami 0B lub 0C.

To samo dotyczy warunków 0D i 0E wrt. typ kolei <small>''(railtypes)''</small> i ich rezerwacja.

Since {{Page:pl/Extrazi/ottdp| |2.5|ttdprev=r1384}}, setting varsize to 8, changes value slightly, the first 4 bytes are the value (generalised GRFID), and the next 4 bytes are a bit mask for the GRFIDs to check. Please note you should make sure any masked bits are also not in the GRFID to check, as value to check against is not currently masked.

=== num-sprites ===

Ten element określa liczbę duszków, które zostaną pominięte, jeśli warunek jest spełniony. Jeśli num-sprites ma wartość zero, cała reszta pliku .grf zostanie pominięta, w przeciwnym razie zostanie pominiętych wiele duszków. Jeśli spowoduje to pominięcie działania 8, plik .grf zostanie uznany za nieaktywny.

Jeśli warunek jest fałszywy, przetwarzanie jest kontynuowane dla następującego duszka.

Począwszy od TTDPatch 2.0.1 alpha 49, można przeskoczyć do określonej pozycji w pliku grf, definiując etykiety za pomocą [[en/Action10|action 10]] . Jeśli num-sprites jest numerem etykiety zdefiniowanej gdzieś w pliku, wówczas przetwarzanie pliku grf zostanie wznowione wraz ze sprite'em za etykietą, zamiast pomijania tylu sprite'ów. Jest to jedyny sposób na pominięcie więcej niż 255 duszków na raz.

Od wersji TTDPatch 2.0.1 alfa 70 duplikaty etykiet są w pełni obsługiwane. Skok będzie zawsze następował do pierwszej pasującej etykiety. Jeśli nie pojawi się pasująca etykieta, zostanie zastosowana pierwsza pasująca etykieta w pliku.

Należy pamiętać, że zwykle nie jest bezpiecznie przeskakiwanie do tyłu, tj. Do wcześniejszej pozycji. Chociaż łatka z radością to zrobi, otrzymasz dziwne wyniki, jeśli niektóre działania zostaną powtórzone. Tylko działania 0, 6, 7, 9, C i D można w uzasadniony sposób wykonać więcej niż jeden raz.

== Examples ==

Let's start with an easy Action 7:

 47 * 6 07 83 01 03 00 00

What does this Action 7 tells the program to do with the fictional .grf file?
{|
!Byte!!Meaning
|-
|47||<sprite-number>
|-
|6||<length> of the action in bytes; start counting at 07 (<action>)
|-
|07||<action>: sets this pseudo-sprite to function as action 7
|-
|83||<variable> 83 refers to the 4 different climates
|-
|01||<varsize>: amount of bytes to compare; a single byte for the climate
|-
|03||<condition-type> 03 means skip if the variable is not equal to the <value>
|-
|00||<value> 00 equals temperate climate for this variable
|-
|00||<num-sprites> 00 means to skip the whole .grf file if the condition is true, i.e. for all climates except temperate in this case
|}

Dlatego ta akcja 7 pomija resztę pliku, jeśli jest ładowany w klimacie innym niż klimat umiarkowany.

=== Check for a specific TTDPatch version ===

Ponieważ akcja 7 jest pomijana podczas inicjacji, a bit ważności 7 akcji B nie działa przed TTDPatch 2.0.1 alfa 66, najlepszym sposobem sprawdzenia wymaganej wersji łatki jest następująca sekwencja:

  // Check for TTDPatch 2.0.1 alpha 57, skip action B if present
 1 * 9       09 8B 04 05 39 02 0A 02 01
  // Abort with fatal action B if not (during its first activation)
 2 * 19      0B 03 1F 00 32 2E 30 2E 31 20 61 6C 70 68 61 20 35 37 00
  // Action 8
 3 * ...     08 06 ...
  // Skip rest of file if not TTDPatch 2.0.1 alpha 57,
  // to prevent meaningless "invalid sprite" errors
 4 * 9       09 8B 04 04 3A 02 0A 02 00

W ten sposób pozycja Status GRF pokazuje właściwy komunikat o błędzie, a także poprawną nazwę i opis, ponieważ akcja 8 jest nadal przetwarzana podczas inicjalizacji, a wszystkie nieznane duszki są pomijane, tak że komunikat o błędzie "invalid sprites" (nieprawidłowe 'sprity') nie jest pokazywany pierwszy ( inaczej stałby się stałym komunikatem wyświetlanym w oknie statusu GRF) .

=== Bezwarunkowy skok ===

Var 9A zawsze ma ustawione wszystkie bity, więc aby wykonać bezwarunkowy skok, możesz użyć trochę testu:

 1 * 7   07 9A 01 00 00 01 resp.
 1 * 7   07 9A 01 \71 00 01

W ten sposób sprawdza się, czy bit 0 z pierwszego bajtu zmiennej 9A jest ustawiony (którym zawsze jest), więc duszek, który umieścisz po tej akcji 7, jest zawsze pomijany.