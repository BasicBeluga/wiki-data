{{pl/Development/NewGRF/inne strony|en=newgrf-specs.tt-wiki.net/wiki/VariationalAction2/Vehicles|pl=pl/Development/NewGRF/NFO Specs/VariationalAction2/Vehicles}}
{{en/-}}<!--<br>--><!--{{ambox | text = w trakcie edycji.}}--><!-- -->
<div style="float:right; padding-left:12px; background:none;">{{pl/Development/NewGRF/NFO Specs/Navigation}}</div>

==Wprowadzenie==

== Variables ==

{|
!Variable!![[pl/Development/NewGRF/NFO Specs/GRFActionsDetailed|Size]]!!Version!!Description!!Available in purchase list
|+
|10||D||{{pl/Development/NewGRF/ottdp|1.2|no|ottdrev=r23080}}||Pick sprites for different GUI windows - See [[pl/Development/NewGRF/NFO Specs/Action2/Vehicles|Action2/Vehicles]].||{{pl/Development/NewGRF/ottdp|1.2|no|ottdrev=r23080}}
|+
|40||D||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Position in consist and length of consist||no
|+
|41||D||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Position in and length of chain of consecutive vehicles with same ID||no
|+
|42||D||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Cargo types transported by consist||no
|+
|43||D||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Player info||{{pl/Development/NewGRF/ottdp|0.6|2.5|ottdrev=r4611|ttdprev=beta 2}}
|+
|44||D||{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=2.0.1 alpha 48}}||Aircraft info||no
|+
|45||D||{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=2.0.1 alpha 58}}||Curvature info||no
|+
|46||D||{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=2.0.1 alpha 59}}||Motion counter||no
|+
|47||D||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Vehicle cargo info||{{pl/Development/NewGRF/ottdp|0.7|no|ottdrev=r15542}} <ref name="var47">Variable 47 refers to the default cargo of the vehicle, when in purchase list. This differs from the cargo used in Action 3, which is 0xFF in purchase list. The "refit cycle" (F2) is currently always zero in the purchase list.</ref>
|+
|48||D||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Vehicle type information||{{pl/Development/NewGRF/ottdp|0.6|2.5|ottdrev=r5338|ttdprev=beta 2}}
|+
|49||D||{{pl/Development/NewGRF/ottdp|0.7|2.6|ottdrev=r13376|ttdprev=r2216}}||Year of construction (long format, 0 based)||{{pl/Development/NewGRF/ottdp|0.7|no|ottdrev=r13376}} <ref name="date">This is the current date</ref>
|+
|4A||D||{{pl/Development/NewGRF/ottdp|1.1|no|ottdrev=r20165}}||Info about current railtype/roadtype/tramtype||no
|+
|4B||D||{{pl/Development/NewGRF/ottdp|1.2|no|ottdrev=r23068}}||Long date of last servicing||{{pl/Development/NewGRF/ottdp|1.2|no|ottdrev=r23068}} <ref name="date" />
|+
|4C||D||{{pl/Development/NewGRF/ottdp|1.3|no|ottdrev=r24246}}||Current max speed including e.g track or timetable speed limits. Only valid for front vehicle. Note, units differ for each vehicle type<ref name="speed">See [[pl/Development/NewGRF/NFO Specs/Action0/Vehicles/Trains#speed-09|train property 09]], [[pl/Development/NewGRF/NFO Specs/Action0/Vehicles/RoadVehicles|road vehicle property 08]] (not 15, even when using realistic acceleration), [[pl/Development/NewGRF/NFO Specs/Action0/Vehicles/Ships|ship property 0B]] and [[pl/Development/NewGRF/NFO Specs/Action0/Vehicles/Planes|aircraft property 0C]].</ref>||no
|+
|4D||D||{{pl/Development/NewGRF/ottdp|1.4|no|ottdrev=r26157}}||Position within articulated vehicle||no
|+
|60||D||{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=2.0.1 alpha 57}}||Count Veh.ID occurence||no
|+
|61||-<ref>The size of the result matches the size of the queried variable.</ref>||{{pl/Development/NewGRF/ottdp|1.2|no|ottdrev=r22997}}||Query variable of n-th vehicle in chain||no
|+
|62||D||{{pl/Development/NewGRF/ottdp|1.2|no|ottdrev=r22998}}||Curvature/position difference for n-th vehicle in chain||no
|+
|97||B||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Tick counter, increased every engine tick||no
|+
|B2||W||||Vehicle status: bit0 = vehicle invisible (in tunnel/depot), bit1 = stopped, bit7 = crashed||no
|+
|B4||W||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Current speed. Note, units differ for each vehicle type<ref name="speed" />||no
|+
|B9||B||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Cargo type (type B from the list at [[pl/Development/NewGRF/NFO Specs/CargoTypes|CargoTypes]]; climate dependent)||no
|+
|C0||W||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Engine age in days<br/>{{pl/Development/NewGRF/ottdp|1.2|2.5|ottdrev=r22816|ttdprev=alpha 61}} Valid for wagons and articulated parts as well.||no
|+
|C4||B||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Year built (counted from 1920), note this is modified when Cht: Year is used||{{pl/Development/NewGRF/ottdp|0.6|no|ottdrev=r4611}} <ref name="date" />
|+
|C6||W||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Vehicle type ID <ref>{{pl/Development/NewGRF/ottdp|0.7|no}} In OpenTTD 0.7 and newer this is the GRF-local ID of the vehicle. Earlier versions of OpenTTD and TTDPatch report the [[en/VehicleIDs|TTD ID]]. For trains this is the same; for other vehicle types they differ.</ref> (useful for [[en/Callbacks#can-wagon-be-attached-1d|Callback 1D]])||no
|+
|C8||B||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Sprite type; FD for trains forward, FE or FF when reversed||no
|+
|C9||B||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Day counter; increased daily||no
|+
|DA||W||{{pl/Development/NewGRF/ottdp|0.6|2.0}}||Next wagon index, FFFF if last wagon (use shift-num=08 and check for FF)||no
|+
|F2||B||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Refit cycle, how many times refitted to the same cargo type||{{pl/Development/NewGRF/ottdp|0.7|no|ottdrev=r15542}} <ref name="var47" />
|+
|FE||W||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Modflags||no
|+
|FF||B||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Modflags||no
|}

<references />

W przypadku innych 80 + x zmiennych nadaj [http://marcin.ttdpatch.net/sv1codec/TTD-locations.html#_VehicleArray TTD vehicle structure] .

Zmienne 40, 41, 42 i 43 są buforowane. Oznacza to, że chociaż są one zasadniczo drogie obliczeniowo, mogą być używane bez wpływu na wydajność. Zmienne 45 i 60 są również drogie obliczeniowo, ale nie można ich buforować, dlatego należy ich używać oszczędnie. Jeśli to możliwe, należy preferować zmienne 80+x.

Zmienione w pamięci podręcznej zmienne są aktualizowane, gdy gra jest załadowana, kiedy konsola wjeżdża lub jest przestawiana w składzie i kiedy pociąg się cofa.

Na liście zakupów dostępnych jest tylko kilka zmiennych. W szczególności nie można uzyskać dostępu do pojazdu przedniego (obiekt powiązany) ani innych części przegubowych.

== Description ==
=== Position and length (40, 41) ===

'''Format:''' 00nnbbff

{| |-
!Variable!!Value
|-
|ff||position of vehicle within the consist counted from the engine (front), e.g. the engine would have ff=0, the 1st wagon or mail compartment of planes would have ff=1, the 2nd wagon or the rotor of helicopters would have ff=2, the 3rd wagon would have ff=3 etc
|-
|bb||same as ff, but counted from the end, i.e. the last wagon has bb=0, the next-to-last wagon has bb=1 etc.
|-
|nn||Total number of vehicles in the consist, including shadow and rotor for aircraft.
* In var 40 this is zero-based. That is, the value returned is one less than the actual number of vehicles. A train with engine and three wagons has nn=3.
* In var 41 this is one-based. That is, the value returned is the actual number of vehicles.
|}

W przypadku zmiennej 40 liczby te odnoszą się do całości, ale w przypadku zmiennej 41 odnoszą się tylko do łańcucha kolejnych pojazdów o tym samym identyfikatorze co obecny wagon (w tym sam, ale być może z wyłączeniem silnika):

<!--[[File:vehicle_var40_41.png]]-->[http://newgrf-specs.tt-wiki.net/wiki/File:vehicle_var40_41.png File:vehicle_var40_41.png]

Należy jednak pamiętać, że dostęp do "pokrewnego" <small>''(related)''</small> obiektu (tj. Lokomotywy) nie ma większego sensu w przypadku pojazdów Vars 40/41, z wyjątkiem var40 w łańcuchu  [[pl/Development/NewGRF/NFO Specs/Callback/Main Page#can-wagon-be-attached-1d|callback 1D]] .

=== Consist cargo (42) ===

'''Format:''' uuiicctt

{| |-
!Variable!!Value
|-
|tt||a bit mask of all [[en/Action0Cargos#cargo-classes-16|cargo classes]] transported by the consist
|-
|cc||the most common [[en/CargoTypes|cargo type]] (from the column for type A)
|-
|ii||the most common refit cycle (var. F2) of cargo type cc
|-
|uu||the result of ORing the bits of prop. 25 from all vehicles in the train
|}

W przypadku użycia z VarAction2 typ 81 (pojazd) zwraca on tylko ładunek z tego pojazdu, przy typie 82 (silnik), na który składa się całość.
Zobacz także zmienną 47, aby uzyskać więcej informacji na temat ładunku przewożonego przez pojazd.

{{pl/Development/NewGRF/grfTill|7}} Dla wersji GRF 7 i wcześniejszych „cc” to nieprzetłumaczony numer bitu z  [[pl/Development/NewGRF/NFO Specs/Action0/Cargos#bit-number-for-bitmasks-08|cargo property 8]] .

{{pl/Development/NewGRF/grfFrom|8}} W wersji 8 GRF zmienia się znaczenie „cc”. Jeśli plik grf zainstalował  [[pl/Development/NewGRF/NFO Specs/Action0/Global Settings#cargo-translation-table-09|cargo translation table]] , wartość w "cc"  jest indeksem ładunku w tej tabeli; lub FF, jeżeli ładunku nie ma w tabeli.

=== Player info (43) ===

'''Format:''' Ccttmmnn

{| |-
!Variable!!Value
|-
|nn||the number of the current player from 0 to 7 (up to E (14) in OpenTTD since r14735)
|-
|mm||the multiplayer player number with the host player (or the single player) being 0 and the client player being 1
|-
|tt||the player type, see below for possible values
|-
|c||the primary player colour
|-
|C||{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=r1405}} the secondary player colour, equal to c if none (since r1405)
|}


{| |-
!tt value!!Meaning
|-
|0||Player is human player (permanent company)
|-
|1||Player is AI player (not managed)
|-
|2||{{pl/Development/NewGRF/ottdp|no|2.5}} Player is a human managing an AI company
|-
|3||{{pl/Development/NewGRF/ottdp|no|2.5}} Player is human player's original company, now temporarily AI controlled
|}

{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=r1497}} Od r1497, kiedy 'sprite' pojazdu jest wyświetlana w oknie ekskluzywnej oferty lub wiadomości z nowym pojazdem, lub w innych okolicznościach, gdy z pojazdem nie jest powiązany żaden gracz, nn będzie FF.

=== Aircraft info (44) ===

'''Format:''' xxxxhhtt

hh jest wysokością statku powietrznego nad ziemią, a właściwie wysokością jego cienia. Budynki, w tym lądowisko dla śmigłowców, nie liczą się jako "ziemia" <small>''(ground)''</small> , tj. Aby uzyskać wysokość nad lądowiskiem dla śmigłowców, należy odjąć wysokość lądowiska dla śmigłowców od hh.

tt jest rodzajem bieżącego lotniska: 0=mały, 1=duży, 2=lądowisko dla śmigłowców, 3=platforma wiertnicza. Obecne lotnisko to lotnisko docelowe dla samolotów, które zakończyły wynurzanie i są w locie.

=== Curvature info (45) ===

'''Format:''' xxxTxBxF

Zwraca to krzywiznę między sąsiednimi parami wagonów. Jest to przydatne w przypadku pojazdów kolejowych, które zwykle przechylają się na zakrętach. Krzywizna to różnica w kierunku między otaczającymi pojazdami:

F = dla przedniej pary (poprzedni wagon do obecnego wagonu, 0, jeśli pojazd jest pierwszy)

B = dla tylnej pary (aktualny wagon na następny, 0 jeśli wagon jest ostatni)

T = dla tripletu (poprzedni wagon do następnego wagonu; zero na zakręcie S)

Możliwa wartość:

{| |-
!Decimal!!Hex!!Meaning
|-
| -4||C||180° curve left (T only)
|-
| -3||D||135° curve left (T only)
|-
| -2||E||90° curve left
|-
| -1||F||45° curve left
|-
|0||0||no curve
|-
|1||1||45° curve right
|-
|2||2||90° curve right
|-
|3||3||135° curve right (T only)
|-
|4||4||180° curve right (T only)
|}

=== Motion counter (46) ===

'''Format:''' 32-bit value

Ta zmienna zlicza ruch, który wykonał pojazd. &nbsp;Dotyczy tylko pierwszego pojazdu w składzie (tzn. Należy użyć VarAction2 typ 82!). &nbsp;Jego wartość wynosi 1/4096 płytki. &nbsp;Pojazd faktycznie porusza się w sposób widoczny za każdym razem, gdy licznik ruchu wzrasta o 256, a ponieważ płytka składa się z 16 takich podjednostek, 16 * 256 = 4096 jednostek ruchu oznacza ruch na jednej płytce.

Najbardziej przydatnym sposobem dostępu jest prawdopodobnie &lt;shiftnum&gt;=08 i odpowiedni &lt;andmask&gt;. &nbsp;Na przykład, aby uzyskać animację z jedną klatką na ruch pojazdu i łącznie 16 klatek dla ruchu na całej płytce, należy użyć &lt;shiftnum&gt;=08 i &lt;andmask&gt;=0F. &nbsp;Aby uzyskać animację z jedną klatką co dwa ruchy pojazdu i łącznie 4 klatki, użyj &lt;shiftnum&gt;=09 i  &lt;andmask&gt;=03.

Jeśli pojazd jedzie bardzo szybko (&gt;160 mph dla trains), może przesuwać się o kilka 1/16 części kafla jednocześnie, dlatego niektóre klatki mogą być pomijane, ale animacja nadal będzie zsynchronizowana z ruchem.

Pamiętaj, że grafika pojazdu jest aktualizowana tylko za każdym razem, gdy pojazd faktycznie się porusza, więc sprawdzenie dolnego bajtu jest prawdopodobnie bezcelowe i potrzebne tylko wewnętrznie, aby osiągnąć wystarczającą precyzję.

=== Vehicle cargo info (47) ===

'''Format:''' ccccwwtt

{| |-
!Variable!!Value
|-
|tt||the [[en/CargoTypes|cargo type]] transported by the vehicle (from the column for type A); translated if a translation table has been installed
|-
|ww||cargo unit weight in 1/16 tons, same as [[en/Action0Cargos#weight-of-one-unit-of-the-cargo-0f|cargo prop. 0F]]
|-
|cccc||the [[en/Action0Cargos#cargo-classes-16|cargo class]] value of the cargo transported by the vehicle
|}

Zauważ, że jeśli GRF zainstalował [[pl/Development/NewGRF/NFO Specs/Action0/Global Settings#cargo-translation-table-09|cargo translation table]] , wartość w „tt” jest numerem szczeliny w tej tabeli, niezależnie od tego, która faktyczna szczelina lub bit ładunek wykorzystuje w gra. Jeśli tabela została zainstalowana, ale aktualny ładunek nie jest tam wymieniony, „tt” zostanie ustawione na FF.

W przeciwieństwie do zmiennej 42, zmienna ta zwraca informacje tylko o bieżącym pojeździe, a nie konsystencję.

=== Vehicle type information (48) ===

'''Format:''' xxxxxxff

Bity FF są:

{| |-
!Bit!!Value!!Meaning
|-
|0||1||Vehicle type is available on the market
|-
|1||2||Vehicle type is in the testing phase
|-
|2||4||Exclusive testing offer for a human player active
|}

Wszystkie inne bity w ff są niezdefiniowane i muszą zostać zamaskowane.

=== Information about current railtype/roadtype/tramtype (4A) ===

'''Format:''' xxxxFFrr

Dolny bajt (rr) zawiera (przetłumaczony) typ szyny / typ drogi / typ tramwaju, na którym pojazd jedzie.

Jeśli typ szyny/typ drogi/typ tramwaju <small>''(railtype/roadtype/tramtype)''</small> nie ma wpisu w tabeli translacji typu szyna/droga/typ tramwaju GRF, wartość ta będzie wynosić 0xFF.

Jeśli nie ma tabeli translacji, zwracana jest surowa wartość.

Pociągi zwrócą typ szyny. {{pl/Development/NewGRF/ottdp|1.10|no}} Pojazdy drogowe (z wyjątkiem tramwajów) zwracają typ drogi. Tramwaje zwrócą kolej.

Tylko dla pociągów następny bajt (FF) zawiera następujące flagi:

{| |-
!Bit!!Value!!Meaning
|-
|0||1||The vehicle is/would be powered on the current railtype (this is independent from powered/non-powered wagon or anything)
|}

Wszystkie pozostałe bity są niezdefiniowane.

Wszystkie pozostałe bajty i wynik dla pojazdów innych niż kolejowe są niezdefiniowane.

=== Position within articulated vehicle (4B) ===

'''Format:''' xxxxbbff

{| |-
!Variable!!Value
|-
|ff||Position of vehicle (articulated part) within the articulated vehicle, counted from the first part, starting with 0.
|-
|bb||Position of vehicle (articulated part) within the articulated vehicle, counted from the last part, starting with 0.
|-
|xx||Reserved, do not access.
|}

Całkowita liczba przegubowych części pojazdu wynosi ff + 1 + bb.

Dla pojazdów drogowych  "ff" i "bb" są obecnie równe var 40, ponieważ nie ma jeszcze wagonów pojazdów drogowych.

=== Count Veh.ID occurence (60) ===

'''Format:''' xxxxxxnn

Parametr 60+x to szukany identyfikator pojazdu, a zwracana nn to liczba pojazdów w konsolach, które mają ten identyfikator. W przypadku użycia z VarAction2 typu 81, sprawdzany będzie tylko bieżący pojazd i nowsze, przy VarAction2 typu 82 wszystkie pojazdy w składzie zostaną policzone.

=== Query variable of n-th vehicle in chain (61) ===

Jest to specjalna zmienna, aby uzyskać zawartość innej zmiennej innego pojazdu w łańcuchu pojazdu. Jest obsługiwany tylko w pociągach i pojazdach drogowych. Nie jest obsługiwany podczas wywołania zwrotnego używanego do modyfikowania właściwości pojazdu w celu uniknięcia zależności kołowych, co obecnie ogranicza tę zmienną do wywołań zwrotnych 1D, 2D, 31 i 32 oraz poza zakresem oddzwaniania.

Rejestr tymczasowy 10F jest interpretowany jako liczba całkowita ze znakiem i określa przesunięcie w łańcuchu od bieżącego pojazdu. Wartości dodatnie są interpretowane jako w kierunku końca, wartości ujemne w kierunku do przodu. Jeśli przesunięcie znajduje się poza łańcuchem pojazdu, wartość wyniku wyniesie 0.

Parametr 60 + x określa zmienną dostępową, a rejestr tymczasowy 10E jest przekazywany jako nowy parametr 60 + x. Przekazanie 61 jako zmiennej jest niedozwolone. Obecnie tylko zmienne specyficzne dla pojazdu wymienione na tej stronie oraz zmienna globalna 25 i  {{pl/Development/NewGRF/ottdp|1.3|no|ottdrev=r24527}} 5F są dostępne poprzez var 61.

Wynikowa wartość będzie miała wielkość dowolnej zmiennej, której dotyczy zapytanie.

=== Curvature/position difference for n-th vehicle in chain (62) ===

'''Format:''' zzyyxxFD

This variable is only supported for trains and road vehicles.

Parametr 60 + x jest interpretowany jako liczba całkowita ze znakiem i określa przesunięcie w łańcuchu od bieżącego pojazdu. Wartości dodatnie są interpretowane jako w kierunku końca, wartości ujemne w kierunku do przodu. Jeśli przesunięcie znajduje się poza łańcuchem pojazdu, wartość wyniku wyniesie 0.

Najniższa skórka (D) zawiera różnicę kierunku między wybranym pojazdem a tym pojazdem, możliwe wartości są identyczne z wartościami [[#curvature-info-45|variable 45]] .

Następny skubek (F) ma następujące znaczenie:
{| |-
!Bit!!Value!!Meaning
|-
|3||8||The vehicle is currently hidden
|}

Trzy górne bajty zawierają podpisaną różnicę pozycji X/Y/Z między wybranym pojazdem a tym pojazdem.

=== Modflags (FE and FF) ===

Bity w FE dotyczą głównie ładowania stopniowego. &nbsp;Kilka przydatnych bitów dla autorów grf;

{| |-
!Bit!!Version!!Value of the bit
|-
|1||{{pl/Development/NewGRF/ottdp|1.5|2.5|ottdrev=r26430}}||Vehicle is still unloading and has not yet started loading new cargo at the current station.
|-
|5||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Vehicle is powered (engine or powered wagon, mainly useful for the latter)
|-
|6||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||Vehicle would be powered (engine or powered wagon) if there were suitable track. (E.g. electric train in mixed train on normal track)
|-
|8 <ref>This bit is only accurate for the first vehicle in the consist.</ref>||{{pl/Development/NewGRF/ottdp|0.6|2.5}}||This bit is flipped every time the train reverses direction
|-
|10||{{pl/Development/NewGRF/ottdp|0.6|2.5|ttdprev=r1334}}||Vehicle was built during the exclusive preview
|}
<references/>

zmienna FF jest tak naprawdę wysokim bajtem zmiennej FE, więc bit FE 8 jest taki sam jak bit FF 0.

Inne bity są zastrzeżone; większość z nich jest faktycznie wykorzystywana w stanach wewnętrznych TTDPatch.

==Przykłady==